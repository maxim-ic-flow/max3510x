/*******************************************************************************
 * Copyright (C) 2017 Maxim Integrated Products, Inc., All Rights Reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL MAXIM INTEGRATED BE LIABLE FOR ANY CLAIM, DAMAGES
 * OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
 * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * Except as contained in this notice, the name of Maxim Integrated
 * Products, Inc. shall not be used except as stated in the Maxim Integrated
 * Products, Inc. Branding Policy.
 *
 * The mere transfer of this software does not imply any licenses
 * of trade secrets, proprietary technology, copyrights, patents,
 * trademarks, maskwork rights, or any other form of intellectual
 * property whatsoever. Maxim Integrated Products, Inc. retains all
 * ownership rights.
 *
 ******************************************************************************/

// The MAX3510x uses SPI Mode 1 (SCK low, negative edge)
// byte order is big endian (most significant byte transmits first)

// Define the target chip type:  MAX35101, MAX35102, MAX35103, or max35104

#if !defined(MAX35101) && !defined(MAX35102) && !defined(MAX35103) && !defined(MAX35104)
#error Define the target chip type for max3510x_regs.h:  MAX35101, MAX35102, MAX35103, or max35104
#endif

#define MAX3510X_REG_MASK(r)		((1 << MAX3510X_REG_##r##_WIDTH ) - 1) 

// The following macros enable bitfield access
// 'r' is token pasted, 'v' is not.
#define MAX3510X_REG_SET(r,v)		(uint16_t)(( MAX3510X_REG_MASK(r) & (v)) << MAX3510X_REG_##r##_SHIFT)
#define MAX3510X_REG_GET(r,v)		( ((v) >> MAX3510X_REG_##r##_SHIFT ) & ((1 << MAX3510X_REG_##r##_WIDTH ) - 1)  )

// This macro enables concise bitfield access using token pasting for both 'r' and 'v'
#define MAX3510X_BF(r,v)			( (((uint16_t)( MAX3510X_REG_##r##_##v )) << MAX3510X_REG_##r##_SHIFT) & (((1<<MAX3510X_REG_##r##_WIDTH)-1) << MAX3510X_REG_##r##_SHIFT) )


#define MAX3510X_NOMINAL_FREQUENCY	(4000000)

#if !defined(MAX35102)
#define MAX3510X_MAX_HITCOUNT			6
#else
#define MAX3510X_MAX_HITCOUNT			3
#endif

#define MAX3510X_HITWV_MIN				3
#define MAX3510X_HITWV_MAX				63

#define MAX3510X_OPCODE_TOF_UP			0x00
#define MAX3510X_OPCODE_TOF_DOWN		0x01
#define MAX3510X_OPCODE_TOF_DIFF		0x02
#define MAX3510X_OPCODE_TEMPERATURE		0x03
#define MAX3510X_OPCODE_RESET			0x04
#define MAX3510X_OPCODE_INITIALIZE		0x05
#if defined(MAX35104)
#define MAX3510X_OPCODE_BANDPASS_CALIBRATE	0x06
#else
#define MAX3510X_OPCODE_FLASH			0x06
#endif
#define MAX3510X_OPCODE_EVTMG1			0x07
#define MAX3510X_OPCODE_EVTMG2			0x08
#define MAX3510X_OPCODE_EVTMG3			0x09
#define MAX3510X_OPCODE_HALT			0x0A

#if defined(MAX35103) || defined(MAX35101)

#define MAX3510X_OPCODE_LDO_TIMED		0x0B
#define MAX3510X_OPCODE_LDO_ON			0x0C
#define MAX3510X_OPCODE_LDO_OFF			0x0D

#endif

#define MAX3510X_OPCODE_CALIBRATE		0x0E

#define MAX3510X_OPCODE_MASK			0x7F
#define MAX3510X_OPCODE_READ_REG(r)		(0x80|(r))
#define MAX3510X_OPCODE_WRITE_REG(r)	(r)

#if defined(MAX35103) || defined(MAX35101)

#define MAX3510X_OPCODE_READ_FLASH		0x90
#define MAX3510X_OPCODE_WRITE_FLASH		0x10
#define MAX3510X_OPCODE_ERASE_FLASH		0x13

#define MAX3510X_FLASH_BLOCK_SIZE_WORDS	(128)
#define MAX3510X_FLASH_BLOCK_COUNT		(32)

#endif

// RTC

#define MAX3510X_REG_SECONDS					0

#define MAX3510X_REG_SECONDS_TENTHS_SHIFT		12
#define MAX3510X_REG_SECONDS_TENTHS_WIDTH		4
#define MAX3510X_REG_SECONDS_HUNDREDTHS_SHIFT	8
#define MAX3510X_REG_SECONDS_HUNDREDTHS_WIDTH	4
#define MAX3510X_REG_SECONDS_10SECS_SHIFT		4
#define MAX3510X_REG_SECONDS_10SECS_WIDTH		4
#define MAX3510X_REG_SECONDS_1SECS_SHIFT		0
#define MAX3510X_REG_SECONDS_1SECS_WIDTH		4

#define MAX3510X_REG_MINS_HRS					1

#define MAX3510X_REG_MINS_HRS_10MINS_SHIFT		12
#define MAX3510X_REG_MINS_HRS_10MINS_WIDTH		3
#define MAX3510X_REG_MINS_HRS_1MINS_SHIFT		8
#define MAX3510X_REG_MINS_HRS_1MINS_WIDTH		4
#define MAX3510X_REG_MINS_HRS_12_24_SHIFT		6
#define MAX3510X_REG_MINS_HRS_12_24_WIDTH		1
#define MAX3510X_REG_MINS_HRS_12_24_MODE_12		1
#define MAX3510X_REG_MINS_HRS_12_24_MODE_24		0
#define MAX3510X_REG_MINS_HRS_20HR_AMPM_SHIFT	5
#define MAX3510X_REG_MINS_HRS_20HR_AMPM_WIDTH	1
#define MAX3510X_REG_MINS_HRS_20HR_AMPM_PM		1
#define MAX3510X_REG_MINS_HRS_20HR_AMPM_AM		0
#define MAX3510X_REG_MINS_HRS_10HR_SHIFT		4
#define MAX3510X_REG_MINS_HRS_10HR_WIDTH		1
#define MAX3510X_REG_MINS_HRS_HOURS_SHIFT		0
#define MAX3510X_REG_MINS_HRS_HOURS_WIDTH		4

#define MAX3510X_REG_DAY_DATE					2

#define MAX3510X_REG_DAY_DATE_DAY_SHIFT			8
#define MAX3510X_REG_DAY_DATE_DAY_WIDTH			3
#define MAX3510X_REG_DAY_DATE_10DATE_SHIFT		4
#define MAX3510X_REG_DAY_DATE_10DATE_WIDTH		2
#define MAX3510X_REG_DAY_DATE_DATE_SHIFT		0
#define MAX3510X_REG_DAY_DATE_DATE_WIDTH		4

#define MAX3510X_REG_MONTH_YEAR					3

#define MAX3510X_REG_MONTH_YEAR_MONTH_SHIFT		8
#define MAX3510X_REG_MONTH_YEAR_MONTH_WIDTH	4
#define MAX3510X_REG_MONTH_YEAR_10MONTH_SHIFT	12
#define MAX3510X_REG_MONTH_YEAR_10MONTH_WIDTH	1

#define MAX3510X_REG_MONTH_YEAR_YEAR_SHIFT		0
#define MAX3510X_REG_MONTH_YEAR_YEAR_WIDTH		4
#define MAX3510X_REG_MONTH_YEAR_10YEAR_SHIFT	4
#define MAX3510X_REG_MONTH_YEAR_10YEAR_WIDTH	4

#define MAX3510X_REG_WATCHDOG_ALARM_COUNTER		4
#define MAX3510X_REG_ALARM						5

#if defined(MAX35104)

#define MAX3510X_REG_SWITCHER1					0x14

#define MAX3510X_REG_SWITCHER1_SFREQ_SHIFT		14
#define MAX3510X_REG_SWITCHER1_SFREQ_WIDTH		2

#define MAX3510X_REG_SWITCHER1_SFREQ_100KHZ		0
#define MAX3510X_REG_SWITCHER1_SFREQ_125KHZ		1
#define MAX3510X_REG_SWITCHER1_SFREQ_166KHZ		2
#define MAX3510X_REG_SWITCHER1_SFREQ_200KHZ		3

#define MAX3510X_REG_SWITCHER1_HREG_D_SHIFT		13
#define MAX3510X_REG_SWITCHER1_HREG_D_WIDTH		1

#define MAX3510X_REG_SWITCHER1_HREG_D_ENABLED	0
#define MAX3510X_REG_SWITCHER1_HREG_D_DISABLED	1

#define MAX3510X_REG_SWITCHER1_DREQ_SHIFT		6
#define MAX3510X_REG_SWITCHER1_DREQ_WIDTH		2

#define MAX3510X_REG_SWITCHER1_DREQ_100KHZ		0
#define MAX3510X_REG_SWITCHER1_DREQ_125KHZ		1
#define MAX3510X_REG_SWITCHER1_DREQ_166KHZ		2
#define MAX3510X_REG_SWITCHER1_DREQ_200KHZ		3

#define MAX3510X_REG_SWITCHER1_VS_SHIFT			0
#define MAX3510X_REG_SWITCHER1_VS_WIDTH			4

#define MAX3510X_REG_SWITCHER1_DEFAULT_SHIFT	4
#define MAX3510X_REG_SWITCHER1_DEFAULT_WIDTH	2
#define MAX3510X_REG_SWITCHER1_DEFAULT_DEFAULT	3

#define MAX3510X_REG_SWITCHER1_VS_5V4_50		3
#define MAX3510X_REG_SWITCHER1_VS_5V4_60		4
#define MAX3510X_REG_SWITCHER1_VS_7V2			5
#define MAX3510X_REG_SWITCHER1_VS_9V0			6
#define MAX3510X_REG_SWITCHER1_VS_11V4			7
#define MAX3510X_REG_SWITCHER1_VS_13V2			8
#define MAX3510X_REG_SWITCHER1_VS_15V6			9
#define MAX3510X_REG_SWITCHER1_VS_17V4			10
#define MAX3510X_REG_SWITCHER1_VS_19V2			11
#define MAX3510X_REG_SWITCHER1_VS_21V6			12
#define MAX3510X_REG_SWITCHER1_VS_23V4			13
#define MAX3510X_REG_SWITCHER1_VS_25V2			14
#define MAX3510X_REG_SWITCHER1_VS_27V0			15

#define MAX3510X_REG_SWITCHER2					0x15

#define MAX3510X_REG_SWITCHER2_LT_N_SHIFT		12
#define MAX3510X_REG_SWITCHER2_LT_N_WIDTH		4

#define MAX3510X_REG_SWITCHER2_LT_N_LOOP		0
#define MAX3510X_REG_SWITCHER2_LT_N_0V2			1
#define MAX3510X_REG_SWITCHER2_LT_N_0V4			2
#define MAX3510X_REG_SWITCHER2_LT_N_0V8			4
#define MAX3510X_REG_SWITCHER2_LT_N_1V6			8

#define MAX3510X_REG_SWITCHER2_LT_S_SHIFT		8
#define MAX3510X_REG_SWITCHER2_LT_S_WIDTH		4

#define MAX3510X_REG_SWITCHER2_LT_S_NO_LIMIT	0
#define MAX3510X_REG_SWITCHER2_LT_S_0V2			1
#define MAX3510X_REG_SWITCHER2_LT_S_0V4			2
#define MAX3510X_REG_SWITCHER2_LT_S_0V8			4
#define MAX3510X_REG_SWITCHER2_LT_S_1V6			8

#define MAX3510X_REG_SWITCHER2_ST_SHIFT			4
#define MAX3510X_REG_SWITCHER2_ST_WIDTH			4

#define MAX3510X_REG_SWITCHER2_ST_US(x)			(((x)/64)-1)  // 64us to 16.4ms in 64us increments
#define MAX3510X_REG_SWITCHER2_ST(x)			(((x)+1)*64)
#define MAX3510X_REG_SWITCHER2_ST_US_MIN		64
#define MAX3510X_REG_SWITCHER2_ST_US_MAX		16400

#define MAX3510X_REG_SWITCHER2_LT_50D_SHIFT		3
#define MAX3510X_REG_SWITCHER2_LT_50D_WIDTH		1

#define MAX3510X_REG_SWITCHER2_LT_50D_TRIMMED	0
#define MAX3510X_REG_SWITCHER2_LT_50D_UNTRIMMED	1

#define MAX3510X_REG_SWITCHER2_PECHO_SHIFT		0
#define MAX3510X_REG_SWITCHER2_PECHO_WIDTH		1

#define MAX3510X_REG_SWITCHER2_PECHO_ENABLED	1
#define MAX3510X_REG_SWITCHER2_PECHO_DISABLED	0

#define MAX3510X_REG_AFE1						0x16

#define MAX3510X_REG_AFE1_AFE_BP_SHIFT			15
#define MAX3510X_REG_AFE1_AFE_BP_WIDTH			1

#define MAX3510X_REG_AFE1_AFE_BP_ENABLED		1
#define MAX3510X_REG_AFE1_AFE_BP_DISABLED		0

#define MAX3510X_REG_AFE1_SD_EN_SHIFT			10
#define MAX3510X_REG_AFE1_SD_EN_WIDTH			1

#define MAX3510X_REG_AFE1_SD_EN_ENABLED			1
#define MAX3510X_REG_AFE1_SD_EN_DISABLED		0

#define MAX3510X_REG_AFE1_AFEOUT_SHIFT			8
#define MAX3510X_REG_AFE1_AFEOUT_WIDTH			2

#define MAX3510X_REG_AFE1_AFEOUT_DISABLED		0
#define MAX3510X_REG_AFE1_AFEOUT_BANDPASS		1
#define MAX3510X_REG_AFE1_AFEOUT_PGA			2
#define MAX3510X_REG_AFE1_AFEOUT_FIXED			3

#define MAX3510X_REG_AFE1_WRITEBACK_SHIFT		0
#define MAX3510X_REG_AFE1_WRITEBACK_WIDTH		7

#define MAX3510X_REG_AFE2						0x17

#define MAX3510X_REG_AFE2_4M_BP_SHIFT			15
#define MAX3510X_REG_AFE2_4M_BP_WIDTH			1

#define MAX3510X_REG_AFE2_4M_BP_ENABLED			1
#define MAX3510X_REG_AFE2_4M_BP_DISABLED		0

#define MAX3510X_REG_AFE2_F0_SHIFT				8
#define MAX3510X_REG_AFE2_F0_WIDTH				7

#define MAX3510X_REG_AFE2_PGA_SHIFT				4
#define MAX3510X_REG_AFE2_PGA_WIDTH				4

#define MAX3510X_REG_AFE2_PGA_3_16				0
#define MAX3510X_REG_AFE2_PGA_3_69				1
#define MAX3510X_REG_AFE2_PGA_4_30				2
#define MAX3510X_REG_AFE2_PGA_5_01				3
#define MAX3510X_REG_AFE2_PGA_5_83				4
#define MAX3510X_REG_AFE2_PGA_6_80				5
#define MAX3510X_REG_AFE2_PGA_7_93				6
#define MAX3510X_REG_AFE2_PGA_9_24				7
#define MAX3510X_REG_AFE2_PGA_10_76				8
#define MAX3510X_REG_AFE2_PGA_12_55				9
#define MAX3510X_REG_AFE2_PGA_14_62				10
#define MAX3510X_REG_AFE2_PGA_17_04				11
#define MAX3510X_REG_AFE2_PGA_19_86				12
#define MAX3510X_REG_AFE2_PGA_23_15				13
#define MAX3510X_REG_AFE2_PGA_26_98				14
#define MAX3510X_REG_AFE2_PGA_31_44				15

#define MAX3510X_REG_AFE2_PGA_10_00DB				0
#define MAX3510X_REG_AFE2_PGA_11_33DB				1
#define MAX3510X_REG_AFE2_PGA_12_66DB				2
#define MAX3510X_REG_AFE2_PGA_13_99DB				3
#define MAX3510X_REG_AFE2_PGA_15_32DB				4
#define MAX3510X_REG_AFE2_PGA_16_65DB				5
#define MAX3510X_REG_AFE2_PGA_17_98DB				6
#define MAX3510X_REG_AFE2_PGA_19_31DB				7
#define MAX3510X_REG_AFE2_PGA_20_64DB				8
#define MAX3510X_REG_AFE2_PGA_21_97DB				9
#define MAX3510X_REG_AFE2_PGA_23_30DB				10
#define MAX3510X_REG_AFE2_PGA_24_63DB				11
#define MAX3510X_REG_AFE2_PGA_25_96DB				12
#define MAX3510X_REG_AFE2_PGA_27_29DB				13
#define MAX3510X_REG_AFE2_PGA_28_62DB				14
#define MAX3510X_REG_AFE2_PGA_29_95DB				15

#define MAX3510X_REG_AFE2_PGA_DB_GAIN_STEP			(1.33f)

#define MAX3510X_REG_AFE2_PGA_DB(x)					(((x)-10)/MAX3510X_REG_AFE2_PGA_DB_GAIN_STEP)
#define MAX3510X_REG_AFE2_PGA(x)					(((x)*MAX3510X_REG_AFE2_PGA_DB_GAIN_STEP)+10)

#define MAX3510X_REG_AFE2_PGA_DB_MIN				0
#define MAX3510X_REG_AFE2_PGA_DB_MAX				MAX3510X_REG_MASK(AFE2_PGA)

#define MAX3510X_REG_AFE2_LOWQ_SHIFT			2
#define MAX3510X_REG_AFE2_LOWQ_WIDTH			2

#define MAX3510X_REG_AFE2_LOWQ_12KHZ			0
#define MAX3510X_REG_AFE2_LOWQ_7_4KHZ			1
#define MAX3510X_REG_AFE2_LOWQ_5_3KHZ			2
#define MAX3510X_REG_AFE2_LOWQ_4_2KHZ			3

#define MAX3510X_REG_AFE2_BP_BYPASS_SHIFT			0
#define MAX3510X_REG_AFE2_BP_BYPASS_WIDTH			1

#define MAX3510X_REG_AFE2_BP_BYPASS_ENABLED			1
#define MAX3510X_REG_AFE2_BP_BYPASS_DISABLED		0

#endif // #if defined(MAX35104)

#define MAX3510X_REG_TOF1						0x38

#define MAX3510X_REG_TOF1_PL_SHIFT				8
#define MAX3510X_REG_TOF1_PL_WIDTH				8

#define MAX3510X_REG_TOF1_PL_MIN				0
#define MAX3510X_REG_TOF1_PL_MAX				127

#define MAX3510X_REG_TOF1_DPL_SHIFT				4
#define MAX3510X_REG_TOF1_DPL_WIDTH				4

#define MAX3510X_REG_TOF1_DPL_1MHZ				1
#define MAX3510X_REG_TOF1_DPL_666KHZ			2
#define MAX3510X_REG_TOF1_DPL_500KHZ			3
#define MAX3510X_REG_TOF1_DPL_400KHZ			4
#define MAX3510X_REG_TOF1_DPL_333KHZ			5
#define MAX3510X_REG_TOF1_DPL_286KHZ			6
#define MAX3510X_REG_TOF1_DPL_250KHZ			7
#define MAX3510X_REG_TOF1_DPL_222KHZ			8
#define MAX3510X_REG_TOF1_DPL_200KHZ			9
#define MAX3510X_REG_TOF1_DPL_182KHZ			10
#define MAX3510X_REG_TOF1_DPL_167KHZ			11
#define MAX3510X_REG_TOF1_DPL_153KHZ			12
#define MAX3510X_REG_TOF1_DPL_143KHZ			13
#define MAX3510X_REG_TOF1_DPL_133KHZ			14
#define MAX3510X_REG_TOF1_DPL_125KHZ			15

#define MAX3510X_REG_TOF1_DPL_HZ(f,x)			((uint16_t)((f)/2/(x)-1))
#define MAX3510X_REG_TOF1_DPL(f,r)				((f)/2/(1+(r)))

#define MAX3510X_REG_TOF1_DPL_MIN				1
#define MAX3510X_REG_TOF1_DPL_MAX				15

#define MAX3510X_REG_TOF1_STOP_POL_SHIFT		3
#define MAX3510X_REG_TOF1_STOP_POL_WIDTH		1

#define MAX3510X_REG_TOF1_STOP_POL_NEG_EDGE		1
#define MAX3510X_REG_TOF1_STOP_POL_POS_EDGE		0

#define MAX3510X_REG_TOF1_CT_SHIFT				0
#define MAX3510X_REG_TOF1_CT_WIDTH				2

#define MAX3510X_REG_TOF1_CT_61US				0
#define MAX3510X_REG_TOF1_CT_122US				1
#define MAX3510X_REG_TOF1_CT_244US				2
#define MAX3510X_REG_TOF1_CT_488US				3

#define MAX3510X_REG_TOF2						0x39

#define MAX3510X_REG_TOF2_STOP_SHIFT			13
#define MAX3510X_REG_TOF2_STOP_WIDTH			3

#define MAX3510X_REG_TOF2_STOP_C(c)				((c)-1)			// hit count to register value
#define MAX3510X_REG_TOF2_STOP(r)					((r)+1)			// register value to hit count

#define MAX3510X_REG_TOF2_STOP_MIN				1
#if defined(MAX35102)
#define MAX3510X_REG_TOF2_STOP_MAX				3
#else
#define MAX3510X_REG_TOF2_STOP_MAX				6
#endif

#define MAX3510X_REG_TOF2_TW2V_SHIFT			7
#define MAX3510X_REG_TOF2_TW2V_WIDTH			6

#define MAX3510X_REG_TOF2_TW2V_MAX				63
#define MAX3510X_REG_TOF2_TW2V_MIN				2

#define MAX3510X_REG_TOF2_TOF_CYC_SHIFT			4
#define MAX3510X_REG_TOF2_TOF_CYC_WIDTH			3

#define MAX3510X_REG_TOF2_TOF_CYC_0US			0
#define MAX3510X_REG_TOF2_TOF_CYC_122US			1
#define MAX3510X_REG_TOF2_TOF_CYC_244US			2
#define MAX3510X_REG_TOF2_TOF_CYC_488US			3
#define MAX3510X_REG_TOF2_TOF_CYC_732US			4
#define MAX3510X_REG_TOF2_TOF_CYC_976US			5
#define MAX3510X_REG_TOF2_TOF_CYC_16_65MS		6
#define MAX3510X_REG_TOF2_TOF_CYC_19_97MS		7

#define MAX3510X_REG_TOF2_TIMOUT_SHIFT			0
#define MAX3510X_REG_TOF2_TIMOUT_WIDTH			3

#define MAX3510X_REG_TOF2_TIMOUT_128US			0
#define MAX3510X_REG_TOF2_TIMOUT_256US			1
#define MAX3510X_REG_TOF2_TIMOUT_512US			2
#define MAX3510X_REG_TOF2_TIMOUT_1024US			3
#define MAX3510X_REG_TOF2_TIMOUT_2048US			4
#define MAX3510X_REG_TOF2_TIMOUT_4096US			5
#define MAX3510X_REG_TOF2_TIMOUT_8192US			6
#define MAX3510X_REG_TOF2_TIMOUT_16384US		7


#if defined( MAX35104 ) || defined( MAX35103 ) || defined(MAX35101)

#define MAX3510X_REG_TOF3						0x3A

#define MAX3510X_REG_TOF3_HIT1WV_SHIFT			8
#define MAX3510X_REG_TOF3_HIT1WV_WIDTH			6

#define MAX3510X_REG_TOF3_HIT2WV_SHIFT			0
#define MAX3510X_REG_TOF3_HIT2WV_WIDTH			6


#define MAX3510X_REG_TOF4						0x3B

#define MAX3510X_REG_TOF4_HIT3WV_SHIFT			8
#define MAX3510X_REG_TOF4_HIT3WV_WIDTH			6

#define MAX3510X_REG_TOF4_HIT4WV_SHIFT			0
#define MAX3510X_REG_TOF4_HIT4WV_WIDTH			6

#define MAX3510X_REG_TOF5						0x3C

#define MAX3510X_REG_TOF5_HIT5WV_SHIFT			8
#define MAX3510X_REG_TOF5_HIT5WV_WIDTH			6

#define MAX3510X_REG_TOF5_HIT6WV_SHIFT			0
#define MAX3510X_REG_TOF5_HIT6WV_WIDTH			6

#endif

#define MAX3510X_REG_TOF6						0x3D

#if !defined(MAX35102)

#define MAX3510X_REG_TOF6_C_OFFSETUPR_SHIFT		8
#define MAX3510X_REG_TOF6_C_OFFSETUPR_WIDTH		8

#define MAX3510X_REG_TOF_C_OFFSETR_MIN			-128
#define MAX3510X_REG_TOF_C_OFFSETR_MAX			127

#endif

#define MAX3510X_REG_TOF_C_OFFSET_MV(vcc,mv)	((int8_t)(((mv)*3072/1000)/(vcc)))
#define MAX3510X_REG_TOF_C_OFFSET(vcc,r)		((r)*((vcc)*1000/3072))
		
#define MAX3510X_REG_TOF6_C_OFFSETUP_SHIFT		0
#define MAX3510X_REG_TOF6_C_OFFSETUP_WIDTH		7

#define MAX3510X_REG_TOF_C_OFFSET_MIN			0
#define MAX3510X_REG_TOF_C_OFFSET_MAX			127


#define MAX3510X_REG_TOF7						0x3E

#if !defined(MAX35102)

#define MAX3510X_REG_TOF7_C_OFFSETDNR_SHIFT		8
#define MAX3510X_REG_TOF7_C_OFFSETDNR_WIDTH		8

#endif

#define MAX3510X_REG_TOF7_C_OFFSETDN_SHIFT		0
#define MAX3510X_REG_TOF7_C_OFFSETDN_WIDTH		7

#define MAX3510X_REG_TOF7_C_OFFSET_MIN			0
#define MAX3510X_REG_TOF7_C_OFFSET_MAX			MAX3510X_REG_MASK(TOF7_C_OFFSETDN)

#if defined( MAX35104 ) || defined( MAX35103 ) || defined(MAX35101)

#define MAX3510X_REG_EVENT_TIMING_1				0x3F

#define MAX3510X_REG_EVENT_TIMING_1_TDF_SHIFT	12
#define MAX3510X_REG_EVENT_TIMING_1_TDF_WIDTH	4

#define MAX3510X_REG_EVENT_TIMING_1_TDF_S(_8xs,p)	(((uint16_t)((p)*2*(_8xs)-1) )& MAX3510X_REG_MASK(EVENT_TIMING_1_TDF))
#define MAX3510X_REG_EVENT_TIMING_1_TDF(_8xs,s)		(((s)+1)*(_8xs)/2)

#define MAX3510X_REG_EVENT_TIMING_1_TDF_MIN		0
#define MAX3510X_REG_EVENT_TIMING_1_TDF_MAX		(MAX3510X_REG_MASK(EVENT_TIMING_1_TDF))

#define MAX3510X_REG_EVENT_TIMING_1_TDM_SHIFT	7
#define MAX3510X_REG_EVENT_TIMING_1_TDM_WIDTH	5

#define MAX3510X_REG_EVENT_TIMING_1_TDM_C(c)	((c)-1)	// 1 to 32 cycles
#define MAX3510X_REG_EVENT_TIMING_1_TDM(c)		((c)+1)

#define MAX3510X_REG_EVENT_TIMING_1_TDM_MIN		1
#define MAX3510X_REG_EVENT_TIMING_1_TDM_MAX		MAX3510X_REG_MASK(EVENT_TIMING_1_TDM)+1

#define MAX3510X_REG_EVENT_TIMING_1_TMF_SHIFT	1
#define MAX3510X_REG_EVENT_TIMING_1_TMF_WIDTH	6

#define MAX3510X_REG_EVENT_TIMING_1_TMF_S(_8xs,p)	(((uint16_t)((p)*(_8xs)-1)) & MAX3510X_REG_MASK(EVENT_TIMING_1_TMF))
#define MAX3510X_REG_EVENT_TIMING_1_TMF(_8xs,s)		(((s)+1)*(_8xs))

#define MAX3510X_REG_EVENT_TIMING_1_TMF_MIN		1
#define MAX3510X_REG_EVENT_TIMING_1_TMF_MAX		MAX3510X_REG_MASK(EVENT_TIMING_1_TMF)+1


#define MAX3510X_REG_EVENT_TIMING_1_8XS_SHIFT	0
#define MAX3510X_REG_EVENT_TIMING_1_8XS_WIDTH	1

#define MAX3510X_REG_EVENT_TIMING_1_8XS_1		0
#define MAX3510X_REG_EVENT_TIMING_1_8XS_8		1

#define MAX3510X_REG_EVENT_TIMING_2				0x40

#define MAX3510X_REG_EVENT_TIMING_2_TMM_SHIFT	11
#define MAX3510X_REG_EVENT_TIMING_2_TMM_WIDTH	5

#define MAX3510X_REG_EVENT_TIMING_2_TMM_MIN		1
#define MAX3510X_REG_EVENT_TIMING_2_TMM_MAX		MAX3510X_REG_MASK(EVENT_TIMING_2_TMM)+1

#define MAX3510X_REG_EVENT_TIMING_2_TMM_C(c)	((c)-1)
#define MAX3510X_REG_EVENT_TIMING_2_TMM(c)		((c)+1)

#define MAX3510X_REG_EVENT_TIMING_2_CAL_USE_SHIFT		10
#define MAX3510X_REG_EVENT_TIMING_2_CAL_USE_WIDTH		1
#define MAX3510X_REG_EVENT_TIMING_2_CAL_USE_ENABLED		1
#define MAX3510X_REG_EVENT_TIMING_2_CAL_USE_DISABLED	0

#define MAX3510X_REG_EVENT_TIMING_2_CAL_CFG_SHIFT	7
#define MAX3510X_REG_EVENT_TIMING_2_CAL_CFG_WIDTH	3

#define MAX3510X_REG_EVENT_TIMING_2_CAL_CFG_DISABLED 	0		// autocalibration disabled
#define MAX3510X_REG_EVENT_TIMING_2_CAL_CFG_CYCLE_CYCLE	4	// TOF_DIFF cycle, temperature cycle
#define MAX3510X_REG_EVENT_TIMING_2_CAL_CFG_CYCLE_SEQ	5	// TOF_DIFF cycle, temperature sequence
#define MAX3510X_REG_EVENT_TIMING_2_CAL_CFG_SEQ_CYCLE	6	// TOF_DIFF sequence, temperature cycle
#define MAX3510X_REG_EVENT_TIMING_2_CAL_CFG_SEQ_SEQ		7	// TOF_DIFF sequence, temperature sequence

#if !defined(MAX35104)

#define MAX3510X_REG_EVENT_TIMING_2_TP_SHIFT	5
#define MAX3510X_REG_EVENT_TIMING_2_TP_WIDTH	2

#define MAX3510X_REG_EVENT_TIMING_2_TP_1_3		0	// ports 1 & 3
#define MAX3510X_REG_EVENT_TIMING_2_TP_2_4		1	// ports 2 & 4
#define MAX3510X_REG_EVENT_TIMING_2_TP_1_3_2	2	// ports 1, 3, and 2
#define MAX3510X_REG_EVENT_TIMING_2_TP_1_3_2_4	3	// ports 1, 3, 2, and 4

#endif

#define MAX3510X_REG_EVENT_TIMING_2_PRECYC_SHIFT	2
#define MAX3510X_REG_EVENT_TIMING_2_PRECYC_WIDTH	3

#define MAX3510X_REG_EVENT_TIMING_2_PRECYC_MAX		MAX3510X_REG_MASK(EVENT_TIMING_2_PRECYC)+1


#define MAX3510X_REG_EVENT_TIMING_2_PORTCYC_SHIFT	0
#define MAX3510X_REG_EVENT_TIMING_2_PORTCYC_WIDTH	2

#endif // #if defined( MAX35104 ) || defined( MAX35103 ) || defined(MAX35101)

#if !defined(MAX35104)

#define MAX3510X_REG_TEMPERATURE				0x40

#define MAX3510X_REG_TEMPERATURE_TP_SHIFT	5
#define MAX3510X_REG_TEMPERATURE_TP_WIDTH	2

#define MAX3510X_REG_TEMPERATURE_TP_1_3		0	// ports 1 & 3
#define MAX3510X_REG_TEMPERATURE_TP_2_4		1	// ports 2 & 4
#define MAX3510X_REG_TEMPERATURE_TP_1_3_2	2	// ports 1, 3, and 2
#define MAX3510X_REG_TEMPERATURE_TP_1_3_2_4	3	// ports 1, 3, 2, and 4

#define MAX3510X_REG_TEMPERATURE_PRECYC_SHIFT	2
#define MAX3510X_REG_TEMPERATURE_PRECYC_WIDTH	3

#define MAX3510X_REG_TEMPERATURE_PRECYC(c)	(c)

#define MAX3510X_REG_TEMPERATURE_PORTCYC_SHIFT	0
#define MAX3510X_REG_TEMPERATURE_PORTCYC_WIDTH	2

#endif

#define MAX3510X_REG_EVENT_TIMING_2_PORTCYC_128US	0
#define MAX3510X_REG_EVENT_TIMING_2_PORTCYC_256US	1
#define MAX3510X_REG_EVENT_TIMING_2_PORTCYC_384US	2
#define MAX3510X_REG_EVENT_TIMING_2_PORTCYC_512US	3

#define MAX3510X_REG_TEMPERATURE_PORTCYC_128US	MAX3510X_REG_EVENT_TIMING_2_PORTCYC_128US
#define MAX3510X_REG_TEMPERATURE_PORTCYC_256US	MAX3510X_REG_EVENT_TIMING_2_PORTCYC_256US
#define MAX3510X_REG_TEMPERATURE_PORTCYC_384US	MAX3510X_REG_EVENT_TIMING_2_PORTCYC_384US
#define MAX3510X_REG_TEMPERATURE_PORTCYC_512US	MAX3510X_REG_EVENT_TIMING_2_PORTCYC_512US


#define MAX3510X_REG_TOF_MEASUREMENT_DELAY			0x41

#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_SHIFT	0
#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_WIDTH	16


#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_US(s)	((uint16_t)(4*(s)))	// delay from 25us to 16.38375ms in 250ns intervals
																		    // assumes 4MHz clock.

#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY(s)	((uint16_t)((s)/4))

#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_MIN		MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_US(25)
#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_MAX		MAX3510X_REG_MASK(TOF_MEASUREMENT_DELAY_DLY)

#if defined(MAX35104)
#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_MINIMUM		100
#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_US_MINIMUM	(100.0/4.0)
#else
#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_MINIMUM		18
#define MAX3510X_REG_TOF_MEASUREMENT_DELAY_DLY_US_MINIMUM	(18.0/4.0)
#endif

#define MAX3510X_REG_CALIBRATION_CONTROL					0x42

#define MAX3510X_REG_CALIBRATION_CONTROL_CMP_EN_SHIFT		11
#define MAX3510X_REG_CALIBRATION_CONTROL_CMP_EN_WIDTH		1
#define MAX3510X_REG_CALIBRATION_CONTROL_CMP_EN_ENABLED		1
#define MAX3510X_REG_CALIBRATION_CONTROL_CMP_EN_DISABLED	0

#define MAX3510X_REG_CALIBRATION_CONTROL_CMP_SEL_SHIFT		10
#define MAX3510X_REG_CALIBRATION_CONTROL_CMP_SEL_WIDTH		1

#define MAX3510X_REG_CALIBRATION_CONTROL_CMP_SEL_CMP_EN		1
#define MAX3510X_REG_CALIBRATION_CONTROL_CMP_SEL_UP_DN		0

#define MAX3510X_REG_CALIBRATION_CONTROL_INT_EN_SHIFT		9
#define MAX3510X_REG_CALIBRATION_CONTROL_INT_EN_WIDTH		1

#define MAX3510X_REG_CALIBRATION_CONTROL_INT_EN_ENABLED		1
#define MAX3510X_REG_CALIBRATION_CONTROL_INT_EN_DISABLED	0

#define MAX3510X_REG_CALIBRATION_CONTROL_ET_CONT_SHIFT		8
#define MAX3510X_REG_CALIBRATION_CONTROL_ET_CONT_WIDTH		1

#define MAX3510X_REG_CALIBRATION_CONTROL_ET_CONT_ENABLED	1
#define MAX3510X_REG_CALIBRATION_CONTROL_ET_CONT_DISABLED	0

#define MAX3510X_REG_CALIBRATION_CONTROL_CONT_INT_SHIFT		7
#define MAX3510X_REG_CALIBRATION_CONTROL_CONT_INT_WIDTH		1

#define MAX3510X_REG_CALIBRATION_CONTROL_CONT_INT_ENABLED	1
#define MAX3510X_REG_CALIBRATION_CONTROL_CONT_INT_DISABLED	0

#define MAX3510X_REG_CALIBRATION_CONTROL_CLK_S_SHIFT		4
#define MAX3510X_REG_CALIBRATION_CONTROL_CLK_S_WIDTH		3

#define MAX3510X_REG_CALIBRATION_CONTROL_CLK_S_488US		0
#define MAX3510X_REG_CALIBRATION_CONTROL_CLK_S_1046US		1
#define MAX3510X_REG_CALIBRATION_CONTROL_CLK_S_2930US		2
#define MAX3510X_REG_CALIBRATION_CONTROL_CLK_S_3900US		3
#define MAX3510X_REG_CALIBRATION_CONTROL_CLK_S_5130US		4
#define MAX3510X_REG_CALIBRATION_CONTROL_CLK_S_CONTINUOUS	5

#define MAX3510X_REG_CALIBRATION_CONTROL_CAL_PERIOD_SHIFT	0
#define MAX3510X_REG_CALIBRATION_CONTROL_CAL_PERIOD_WIDTH	4

#define MAX3510X_REG_CALIBRATION_CONTROL_CAL_PERIOD_MIN		0
#define MAX3510X_REG_CALIBRATION_CONTROL_CAL_PERIOD_MAX		MAX3510X_REG_MASK(CALIBRATION_CONTROL_CAL_PERIOD)

#define MAX3510X_REG_CALIBRATION_CONTROL_CAL_PERIOD_US(c)	(((c)*2/61)-1)	// given us, return register value
#define MAX3510X_REG_CALIBRATION_CONTROL_CAL_PERIOD(c)		(((c)+1)*61/2)	// given register value, return us

#define MAX3510X_REG_RTC						0x43

#define MAX3510X_REG_RTC_32K_BP_SHIFT			6
#define MAX3510X_REG_RTC_32K_BP_WIDTH			1

#define MAX3510X_REG_RTC_32K_BP_ENABLED			1
#define MAX3510X_REG_RTC_32K_BP_DISABLED		0

#define MAX3510X_REG_RTC_32K_EN_SHIFT			5
#define MAX3510X_REG_RTC_32K_EN_WIDTH			1

#define MAX3510X_REG_RTC_32K_EN_ENABLED			1
#define MAX3510X_REG_RTC_32K_EN_DISABLED		0

#define MAX3510X_REG_RTC_EOSC_SHIFT				4
#define MAX3510X_REG_RTC_EOSC_WIDTH				1

#define MAX3510X_REG_RTC_EOSC_ENABLED			1
#define MAX3510X_REG_RTC_EOSC_DISABLED			0

#define MAX3510X_REG_RTC_AM_SHIFT				2
#define MAX3510X_REG_RTC_AM_WIDTH				2

#define MAX3510X_REG_RTC_AM_NONE				0
#define MAX3510X_REG_RTC_AM_MINUTES				1
#define MAX3510X_REG_RTC_AM_HOURS				2
#define MAX3510X_REG_RTC_AM_HOURS_MINUTES		3

#define MAX3510X_REG_RTC_WF_SHIFT				1
#define MAX3510X_REG_RTC_WF_WIDTH				1

#define MAX3510X_REG_RTC_WF_SET					1
#define MAX3510X_REG_RTC_WF_CLEAR				0

#define MAX3510X_REG_RTC_WD_EN_SHIFT			0
#define MAX3510X_REG_RTC_WD_EN_WIDTH			1

#define MAX3510X_REG_RTC_WD_EN_ENABLED			1
#define MAX3510X_REG_RTC_WD_EN_DISABLED			0


// following registers are read only


#define MAX3510X_REG_WVRUP						0xC4
#define MAX3510X_REG_HIT1UPINT					0xC5
#define MAX3510X_REG_HIT1UPFRAC					0xC6
#define MAX3510X_REG_HIT2UPINT					0xC7
#define MAX3510X_REG_HIT2UPFRAC					0xC8
#define MAX3510X_REG_HIT3UPINT					0xC9
#define MAX3510X_REG_HIT3UPFRAC					0xCA
#define MAX3510X_REG_HIT4UPINT					0xCB
#define MAX3510X_REG_HIT4UPFRAC					0xCC
#define MAX3510X_REG_HIT5UPINT					0xCD
#define MAX3510X_REG_HIT5UPFRAC					0xCE
#define MAX3510X_REG_HIT6UPINT					0xCF
#define MAX3510X_REG_HIT6UPFRAC					0xD0

#define MAX3510X_REG_AVGUPINT					0xD1
#define MAX3510X_REG_AVGUPFRAC					0xD2

#define MAX3510X_REG_WVRDN						0xD3
#define MAX3510X_REG_HIT1DNINT					0xD4
#define MAX3510X_REG_HIT1DNFRAC					0xD5
#define MAX3510X_REG_HIT2DNINT					0xD6
#define MAX3510X_REG_HIT2DNFRAC					0xD7
#define MAX3510X_REG_HIT3DNINT					0xD8
#define MAX3510X_REG_HIT3DNFRAC					0xD9
#define MAX3510X_REG_HIT4DNINT					0xDA
#define MAX3510X_REG_HIT4DNFRAC					0xDB
#define MAX3510X_REG_HIT5DNINT					0xDC
#define MAX3510X_REG_HIT5DNFRAC					0xDD
#define MAX3510X_REG_HIT6DNINT					0xDE
#define MAX3510X_REG_HIT6DNFRAC					0xDF

#define MAX3510X_REG_AVGDNINT					0xE0
#define MAX3510X_REG_AVGDNFRAC					0xE1

#define MAX3510X_REG_TOF_DIFFINT				0xE2
#define MAX3510X_REG_TOF_DIFFFRAC				0xE3
#define MAX3510X_REG_TOF_CYCLE_COUNT			0xE4
#define MAX3510X_REG_TOF_DIFF_AVGINT			0xE5
#define MAX3510X_REG_TOF_DIFF_AVGFRAC			0xE6

#define MAX3510X_REG_T1INT						0xE7
#define MAX3510X_REG_T1FRAC						0xE8
#define MAX3510X_REG_T2INT						0xE9
#define MAX3510X_REG_T2FRAC						0xEA
#define MAX3510X_REG_T3INT						0xEB
#define MAX3510X_REG_T3FRAC						0xEC
#define MAX3510X_REG_T4INT						0xED
#define MAX3510X_REG_T4FRAC						0xEE

#define MAX3510X_REG_TEMP_CYCLE_COUNT			0xEF
#define MAX3510X_REG_T1_AVGINT					0xF0
#define MAX3510X_REG_T1_AVGFRAC					0xF1
#define MAX3510X_REG_T2_AVGINT					0xF2
#define MAX3510X_REG_T2_AVGFRAC					0xF3
#define MAX3510X_REG_T3_AVGINT					0xF4
#define MAX3510X_REG_T3_AVGFRAC					0xF5
#define MAX3510X_REG_T4_AVGINT					0xF6
#define MAX3510X_REG_T4_AVGFRAC					0xF7

#define MAX3510X_REG_CALIBRATIONINT				0xF8
#define MAX3510X_REG_CALIBRATIONFRAC			0xF9

#define MAX3510X_REG_INTERRUPT_STATUS			0xFE

#define MAX3510X_REG_INTERRUPT_STATUS_TO		(1<<15)		// timeout occured
#define MAX3510X_REG_INTERRUPT_STATUS_AF		(1<<14)		// RTC alarm occured
#define MAX3510X_REG_INTERRUPT_STATUS_TOF		(1<<12)		// time of flight command complete
#define MAX3510X_REG_INTERRUPT_STATUS_TE		(1<<11)		// temperature command complete
#define MAX3510X_REG_INTERRUPT_STATUS_LDO		(1<<10)		// internal LDO stabilized
#define MAX3510X_REG_INTERRUPT_STATUS_TOF_EVTMG	(1<<9)		// event timing TOF complete
#define MAX3510X_REG_INTERRUPT_STATUS_TEMP_EVTMG (1<<8)		// event timing temperature complete

#if defined(MAX35103) || defined(MAX35101)
#define MAX3510X_REG_INTERRUPT_STATUS_FLASH		(1<<7)		// flash ready
#endif

#define MAX3510X_REG_INTERRUPT_STATUS_CAL		(1<<6)		// calibrate complete
#define MAX3510X_REG_INTERRUPT_STATUS_HALT		(1<<5)		// halt command complete
#define MAX3510X_REG_INTERRUPT_STATUS_CSWI		(1<<4)		// case switch. high on CSW pin.

#if defined(MAX35103) || defined(MAX35101)
#define MAX3510X_REG_INTERRUPT_STATUS_INIT		(1<<3)		// initialize complete
#endif

#define MAX3510X_REG_INTERRUPT_STATUS_POR		(1<<2)		// power-on-reset

#define MAX3510X_REG_INTERRUPT_STATUS_INVALID		0xFFFF		// state machine in reset

#define MAX3510X_REG_CONTROL					0xFF

#define MAX3510X_REG_CONTROL_AFA_SHIFT		9
#define MAX3510X_REG_CONTROL_AFA_WIDTH		1

#define MAX3510X_REG_CONTROL_CSWA_SHIFT		8
#define MAX3510X_REG_CONTROL_CSWA_WIDTH		1

#if defined(MAX35104)

#define MAX3510X_REG_CONTROL_HWR_SHIFT		0
#define MAX3510X_REG_CONTROL_HWR_WIDTH		4

#endif

